# MikroTik: Основная информация

## Ключевая информация
### Тип системы
* Программное обеспечение и оборудование для сетей.
* MikroTik производит как физические устройства (роутеры, коммутаторы и точки доступа), так и программное обеспечение для сетевого администрирования.
### Операционная система
RouterOS — это автономная операционная система на базе ядра Linux. Она поддерживает аппаратные устройства MikroTik, но также доступна для виртуальных машин.

  Разработана на основе ядра Linux.

  Основные инструменты для настройки устройств: мощный интерфейс командной строки (CLI), графический интерфейс (Winbox), а также возможность удаленного управления через веб-интерфейс и API. 
  
  ***(важно ответить, что, хотя winbox используется чаще всего, он позволяет выполнять 99% команд, в отличие от консоли. Например, при настройке Wi-Fi, такие параметры как antenna-gain увидеть не получится. Также, имеются различные неисправности, например, беспроводной интерфейс 5ГГц имеет баг во вкладке Current Tx Power, из-за чего скорости не отображаются)***
  
  Поддерживает широкий спектр функций: маршрутизацию, VPN, QoS, файрволы, управление трафиком и другие.

### Производитель

Компания: MikroTik.

Страна происхождения: Латвия.

Год основания: 1996.

# Описание исследуемого устройства

## Основные характеристики
Тип устройства:  hAP ac² 

Версия ROS: v7

Архитектура процессора: MIPSBE

Функции устройства: точка доступа с двойным одновременным подключением, которая обеспечивает покрытие Wi-Fi на частотах 2,4 ГГц и 5 ГГц одновременно. Пять портов Ethernet 10/100/1000 обеспечивают гигабитные подключения для проводных устройств, USB можно использовать для внешнего хранилища или модема 4G / LTE, а устройство поддерживает аппаратное ускорение IPSec.
hAP ac2 (международный) поддерживает диапазон частот 2412-2484 МГц и 5150-5875 МГц (конкретный диапазон частот может быть ограничен законодательством страны).

Полный перечень характеристик устройства можно найти по ссылке:

https://mikrotik.com/product/hap_ac2?ysclid=m3pzxz5hnd850531769

## ARP
> Несмотря на то, что IP-пакеты адресуются с использованием IP-адресов, для фактической передачи данных с одного хоста на другой необходимо использовать аппаратные адреса. Протокол разрешения адресов используется для сопоставления IP-адресов OSI уровня 3 с MAC-адресами OSI уровня 2. Маршрутизатор содержит таблицу используемых в настоящее время записей ARP. Обычно таблица создается динамически, но для повышения безопасности сети ее можно частично или полностью создать статически, добавив статические записи.
Такие записи можно получить следующей коммандой
```
/ip arp print detail
```
```
Flags: X - disabled, I - invalid, H - DHCP, D - dynamic, P - published, 
C - complete 
 0 DC address=172.16.0.254 mac-address=AA:BB:CC:DD:EE:FF interface=B8-MGMT-WIFI 
      published=no 

 1 DC address=192.168.204.200 mac-address=11:22:33:44:55:66 
      interface=PUB-COMM published=no 

 2 DC address=172.16.8.252 mac-address=4C:5E:0C:02:93:71 interface=B8-MGMT-WIFI 
      published=no

```

## ACL
> это список контроля доступом, с помощью которого для субъектов (чаще всего пользователей) устанавливаются допустимые операции с объектом. В Mikrotik ACL могут настраиваться в разных частях системы и служат для разных задач.

## 1. IP Services

   Контролирует доступ к службам маршрутизатора (Winbox, SSH, Telnet, API и др.).

   Можно получить следующей командой:
```
   /ip service print
```
```
  
Flags: X - disabled, I - invalid 
 #   NAME     PORT ADDRESS                                        CERTIFICATE   
 0 XI telnet     23
 1 XI ftp        21
 2 XI www        80
 3   ssh        22 192.168.0.192/27                              
                   10.0.240.0/28                                 
 4 XI www-ssl   443                                                none          
 5 XI api      8728
 6   winbox   8291 192.168.0.192/27                              
                   10.0.240.0/28                                 
 7 XI api-ssl  8729                                                none       
```

## Firewall

> Понимание потока пакетов
Такие задачи, такие как приоритизация и фильтрация трафика, политики маршрутизации, когда необходимо использовать более одного средства RouterOS, требуют знаний: как эти средства работают вместе? Что происходит, когда и почему?

> Схема потока пакетов RouterOS и примеры потоков попытаются ответить на эти вопросы.

> Было бы очень сложно представить, что происходит с пакетом, на одной диаграмме, поэтому схема потока передачи пакетов разделена на три части:

> общая схема;
подробная схема подключения, маршрутизации и MPLS;
диаграмма, показывающая, какие средства и в каком порядке включены в предварительную маршрутизацию, ввод, пересылку, вывод и последующую маршрутизацию.

Общая схема выглядит следующим образом:
![image](https://github.com/user-attachments/assets/7a39396c-0bc6-4c93-982a-f8da685e21b3)

Полное описание Packetflow Diagram можно найти по ссылке:
https://help.mikrotik.com/docs/spaces/ROS/pages/328227/Packet+Flow+in+RouterOS

Для настройки Firewall в Mikrotik служит страница IP Firewall

IP Firewall включает в себя множество вкладок:
### 1. Filter Rules
предназначена для управления правилами фильтрации трафика. С ее помощью можно настроить контроль за входящим, исходящим и транзитным трафиком
```
 ip firewall/filter/print
```
```
Flags: X - disabled, I - invalid; D - dynamic 
 0  D ;;; special dummy rule to show fasttrack counters
      chain=forward action=passthrough 

 1    chain=output action=drop protocol=icmp src-address=10.0.0.1 
      out-interface=ether3 log=no log-prefix="" 

 2    chain=input action=fasttrack-connection hw-offload=yes protocol=udp 
      src-address=172.16.0.32 packet-mark=TV dscp=56 log=no log-prefix="" 
```

## VRF
> RouterOS позволяет создавать несколько экземпляров виртуальной маршрутизации и пересылки на одном маршрутизаторе. Это полезно для VPN MPLS на основе BGP. В отличие от BGP VPLS, которая является технологией уровня 2 OSI, VPN BGP VRF работают на уровне 3 и как таковые обмениваются IP-префиксами между маршрутизаторами. VRF решают проблему перекрытия IP-префиксов и обеспечивают необходимую конфиденциальность (посредством раздельной маршрутизации для разных VPN).

Имеющиеся VRF можно получить командой:
```
/ip vrf print detail
```
```
Flags: X - disabled; * - builtin 
 0    ;;; Another custom VRF
      name="vrf2" interfaces=bridge1 

 1    ;;; Custom VRF
      name="vrf1" interfaces=ether3,ether4 

 2  * name="main" interfaces=all
```

## Полезные ссылки
https://help.mikrotik.com/docs/
